<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body { 
  font-family: 'Roboto', sans-serif; 
  text-align: center; 
  margin: 0; 
  padding: 10px;
  overflow: hidden;
  position: relative;
  min-height: 100vh;
}

body::before {
  content: '';
  position: fixed;
  top: 0; 
  left: 0; 
  right: 0; 
  bottom: 0;
  background: linear-gradient(to bottom, #ebd09e 0%, #251f03 100%);
  z-index: -1;
}
button { font-size: 16px; padding: 5px 10px; margin: 5px; cursor: pointer; }
.image-item { 
  position: absolute; 
  max-width: 120px; 
  max-height: 120px; 
  cursor: grab; 
  user-select: none; 
  touch-action: none; 
  transition: transform 0.1s;
  border-radius: 10px;
  background: transparent;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
}
.image-item img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  pointer-events: none;
  display: block;
}
.particle { 
  position: absolute; 
  font-size: 16px; 
  opacity: 1; 
  pointer-events: none; 
  animation: fadeOut 0.6s ease-out forwards; 
}

@keyframes fadeOut { 
  to { transform: translateY(-20px) scale(0.5); opacity: 0; } 
}
#zones { 
  display: flex; 
  justify-content: space-around; 
  margin-top: 20px; 
}
.zone { 
  width: 40%; 
  height: 150px; 
  border: 2px dashed #333; 
  border-radius: 10px; 
  line-height: 150px; 
  font-size: 20px; 
  color: #333; 
}

/* Popup */
#scorePopup {
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  border:2px solid #333;
  padding:30px;
  font-size:24px;
  z-index:999;
  border-radius:10px;
  box-shadow:0 0 15px rgba(0,0,0,0.5);
}

/* Neon Button Style */
.neon-btn {
  background: linear-gradient(180deg, #f8f6f0 0%, #fffef8 45%, #fff8e8 55%, #f5f0e5 100%);
  color: #000000;
  border: 6px solid #74640a;
  border-radius: 9999px;
  box-shadow: 1px 1px 0 #000, -8px 6px #3b3305, 0 0 20px rgba(255,230,160,0.55);
  font-weight: 700;
  font-size: clamp(1rem, 2vw, 1.5rem);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3), 0 -1px 0 rgba(0, 0, 0, 0.1);
  position: relative;
  padding: clamp(14px, 2.5vw, 20px) clamp(35px, 5vw, 50px);
  transform: translateZ(0);
  transition: all 0.3s ease;
  z-index: 10;
  min-height: 55px;
  cursor: pointer;
}

.neon-btn:hover {
  transform: translateY(-2px);
  box-shadow: 2px 2px 0 #000, -10px 8px #3b3305, 0 0 25px rgba(255,230,160,0.75);
}

#scorePopup button { font-size: 18px; padding: 6px 12px; margin-top: 10px; cursor: pointer; }
</style>
</head>
<body>

<h2>‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: <span id="topicName"></span></h2>



<div id="zones" style="display:none;">
  <div id="correctZone" class="zone">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ</div>
  <div id="wrongZone" class="zone">‡∏ú‡∏¥‡∏î ‚ùå</div>
</div>
<p id="scoreDisplay" style="display:none;">Score: <span id="score">0</span></p>

<!-- Popup -->
<div id="scorePopup">
  <p style="font-size:20px; font-weight:600; margin-bottom:8px; color:#555;">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: <span id="topicDisplay"></span></p>
  <p style="font-size:24px; font-weight:600; margin-bottom:10px; color:#666;">‡∏ä‡∏∑‡πà‡∏≠: <span id="playerNameDisplay"></span></p>
  <p style="font-size:14px; margin-bottom:15px; color:#888;">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà <span id="playCountDisplay">1</span></p>
  <p style="font-size:28px; font-weight:700; margin-bottom:15px;">üéâ Your Score: <span id="finalScore"></span> üéâ</p>
  <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
    <button class="neon-btn" onclick="playAgain()" style="font-size:24px; padding:12px 14px; min-height:48px; width:48px; display:flex; align-items:center; justify-content:center; background:#57e167; border:none;" title="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á">üîÅ</button>
    <button class="neon-btn" onclick="shareScore()" style="font-size:24px; padding:12px 14px; min-height:48px; width:48px; display:flex; align-items:center; justify-content:center; background:#3498db; border:none;" title="‡πÅ‡∏ä‡∏£‡πå">üîó</button>
    <button class="neon-btn" onclick="exportToPDF()" style="font-size:24px; padding:12px 14px; min-height:48px; width:48px; display:flex; align-items:center; justify-content:center; background:#f39c12; border:none;" title="Export PDF">üìÑ</button>
    <button class="neon-btn" onclick="closePopup()" style="font-size:24px; padding:12px 14px; min-height:48px; width:48px; display:flex; align-items:center; justify-content:center; background:#e74c3c; border:none;" title="‡∏õ‡∏¥‡∏î">‚úï</button>
  </div>
</div>

<script>
let audioCtx, baseFreq = 200;
const sparkleChars = ['‚ú®', 'üåü', 'üí´', '‚≠ê'];
let createdImages = {};
let score = 0;
let gameStarted = false;
let playCount = 1; // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô

// ‡πÇ‡∏´‡∏•‡∏î config ‡∏à‡∏≤‡∏Å localStorage
let teacherConfig = JSON.parse(localStorage.getItem('emojiGameConfig') || '{}');
document.getElementById('topicName').innerText = teacherConfig.topic || 'Unknown';

// ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
document.getElementById('zones').style.display = 'flex';
document.getElementById('scoreDisplay').style.display = 'block';
gameStarted = true;


// particle effect
function createParticle(x, y) {
  const p = document.createElement('div');
  p.className = 'particle';
  p.innerText = sparkleChars[Math.floor(Math.random() * sparkleChars.length)];
  p.style.left = `${x}px`;
  p.style.top = `${y}px`;
  p.style.transform = `scale(${Math.random() * 1.5 + 0.5})`;
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 600);
}

// ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡∏≤‡∏Å
function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const s = audioCtx.createBufferSource();
    s.connect(audioCtx.destination);
    s.start();
  }
}

function playSlideTone(freqStart, freqEnd) {
  if (!audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = 'sine';
  osc.frequency.setValueAtTime(freqStart, audioCtx.currentTime);
  osc.frequency.linearRampToValueAtTime(freqEnd, audioCtx.currentTime + 0.15);
  gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.2);
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ
function createDraggableImage(imgData, imageId, isCorrect) {
  if (createdImages[imageId]) return;

  const imageDiv = document.createElement('div');
  imageDiv.classList.add('image-item');
  imageDiv.innerHTML = `<img src="${imgData}" alt="Image">`;

  const startX = 50 + Math.random() * (window.innerWidth - 200);
  const startY = 50 + Math.random() * (window.innerHeight - 350);
  const angle = Math.floor(Math.random() * 360);
  const scale = 0.8 + Math.random() * 0.6;
  
  imageDiv.style.left = `${startX}px`;
  imageDiv.style.top = `${startY}px`;
  imageDiv.style.transform = `rotate(${angle}deg) scale(${scale})`;

  let offsetX, offsetY;
  
  function dragMove(posX, posY) {
    imageDiv.style.left = `${posX}px`;
    imageDiv.style.top = `${posY}px`;
    createParticle(posX + 50, posY + 50);
    playSlideTone(baseFreq, baseFreq + 400);
    baseFreq = baseFreq >= 800 ? 200 : baseFreq + 50;
  }

  // Desktop
  imageDiv.addEventListener('mousedown', e => {
    initAudio();
    e.preventDefault();
    offsetX = e.clientX - imageDiv.offsetLeft;
    offsetY = e.clientY - imageDiv.offsetTop;
    
    function onMove(e) {
      dragMove(e.clientX - offsetX, e.clientY - offsetY);
    }
    
    function onUp() {
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
      checkDrop();
    }
    
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });

  // Mobile
  imageDiv.addEventListener('touchstart', e => {
    initAudio();
    const t = e.touches[0];
    offsetX = t.clientX - imageDiv.offsetLeft;
    offsetY = t.clientY - imageDiv.offsetTop;
  });
  
  imageDiv.addEventListener('touchmove', e => {
    const t = e.touches[0];
    dragMove(t.clientX - offsetX, t.clientY - offsetY);
  });
  
  imageDiv.addEventListener('touchend', e => {
    checkDrop();
  });

  function checkDrop() {
    const rect = imageDiv.getBoundingClientRect();
    const correctZone = document.getElementById('correctZone').getBoundingClientRect();
    const wrongZone = document.getElementById('wrongZone').getBoundingClientRect();

    if (rect.left + rect.width / 2 > correctZone.left && rect.left + rect.width / 2 < correctZone.right &&
        rect.top + rect.height / 2 > correctZone.top && rect.top + rect.height / 2 < correctZone.bottom) {
      if (isCorrect) {
        score += 1;
      } else {
        score -= 1;
      }
      document.getElementById('score').innerText = score;
      imageDiv.remove();
      delete createdImages[imageId];
      checkEndGame();
    } else if (rect.left + rect.width / 2 > wrongZone.left && rect.left + rect.width / 2 < wrongZone.right &&
               rect.top + rect.height / 2 > wrongZone.top && rect.top + rect.height / 2 < wrongZone.bottom) {
      if (!isCorrect) {
        score += 1;
      } else {
        score -= 1;
      }
      document.getElementById('score').innerText = score;
      imageDiv.remove();
      delete createdImages[imageId];
      checkEndGame();
    }
  }

  document.body.appendChild(imageDiv);
  createdImages[imageId] = imageDiv;
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏ö‡πÄ‡∏Å‡∏°
function checkEndGame() {
  if (Object.keys(createdImages).length === 0) {
    document.getElementById('finalScore').innerText = score;
    document.getElementById('playCountDisplay').innerText = playCount; // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    document.getElementById('scorePopup').style.display = 'block';
  }
}

function closePopup() {
  document.getElementById('scorePopup').style.display = 'none';
}

function shareScore() {
  const date = new Date();
  const dateStr = date.toLocaleDateString('th-TH');
  const timeStr = date.toLocaleTimeString('th-TH');
  const percentageScore = Math.min(100, Math.round((score / (teacherConfig.correctImages?.length || 1)) * 100));
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
  let grade = '';
  if (percentageScore >= 80) {
    grade = '‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°';
  } else if (percentageScore >= 60) {
    grade = '‡∏î‡∏µ';
  } else if (percentageScore >= 40) {
    grade = '‡∏û‡∏≠‡πÉ‡∏à';
  } else {
    grade = '‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á';
  }
  
  const opt = {
    margin: [12, 12, 12, 12],
    filename: `${teacherConfig.topic || 'score'}_${date.toISOString().split('T')[0]}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
  };

  const pdfContent = `
    <div style="font-family: 'Arial', sans-serif; color: #333;">
      <!-- Header with Logo Style -->
      <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h1 style="margin: 5px 0; font-size: 24px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h1>
        <p style="margin: 5px 0; font-size: 14px;">Smart Classroom Learning System</p>
      </div>

      <!-- Score Card - Main Focus -->
      <div style="background: #f8f9fa; border: 3px solid #667eea; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
        <p style="font-size: 16px; margin: 0 0 15px 0; color: #555;"><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</strong></p>
        <div style="display: flex; gap: 15px; justify-content: center;">
          <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border: 2px solid #27ae60;">
            <p style="font-size: 28px; color: #27ae60; font-weight: bold; margin: 0;">${score}/${teacherConfig.correctImages?.length || 0}</p>
            <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
          </div>
          <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border: 2px solid #f39c12;">
            <p style="font-size: 28px; color: #f39c12; font-weight: bold; margin: 0;">${grade}</p>
            <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">‡∏£‡∏∞‡∏î‡∏±‡∏ö</p>
          </div>
        </div>
      </div>

      <!-- Attempt Info -->
      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
        <p style="margin: 0; font-size: 14px;"><strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${playCount}</strong> - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô/‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
      </div>

      <!-- Course Info -->
      <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
        <p style="font-size: 14px; font-weight: bold; margin: 0 0 10px 0; color: #667eea;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.week || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.topic || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.unit || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.teacher || '-'}</td>
          </tr>
        </table>
      </div>

      <!-- Student Info -->
      <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
        <p style="font-size: 14px; font-weight: bold; margin: 0 0 10px 0; color: #667eea;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.playerName || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${dateStr}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡πÄ‡∏ß‡∏•‡∏≤:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${timeStr}</td>
          </tr>
        </table>
      </div>

      <!-- Footer -->
      <div style="text-align: center; border-top: 2px solid #ddd; padding-top: 15px; margin-top: 20px; color: #999; font-size: 11px;">
        <p style="margin: 5px 0;">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£</p>
        <p style="margin: 5px 0;">Smart Classroom Learning Management System</p>
        <p style="margin: 5px 0; color: #bbb;">üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${date.toISOString()}</p>
      </div>
    </div>
  `;

  const element = document.createElement('div');
  element.innerHTML = pdfContent;
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ä‡∏£‡πå
  html2pdf().set(opt).from(element).output('blob').then(blob => {
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á File object
    const file = new File([blob], opt.filename, { type: 'application/pdf' });
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      navigator.share({
        files: [file],
        title: 'Smart Classroom - ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
        text: `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${score}/${teacherConfig.correctImages?.length || 0}`
      }).catch(err => console.log('Error sharing:', err));
    } else {
      // Fallback: ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ó‡∏ô
      html2pdf().set(opt).from(element).save();
    }
  });
}

function playAgain() {
  // ‡∏£‡∏µ‡πÄ‡∏ã‡∏ï‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
  createdImages = {};
  score = 0;
  playCount++; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  document.getElementById('score').innerText = score;
  document.getElementById('scorePopup').style.display = 'none';
  
  // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà
  initGame();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Export PDF
function exportToPDF() {
  const date = new Date();
  const dateStr = date.toLocaleDateString('th-TH');
  const timeStr = date.toLocaleTimeString('th-TH');
  const percentageScore = Math.min(100, Math.round((score / (teacherConfig.correctImages?.length || 1)) * 100));
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
  let grade = '';
  if (percentageScore >= 80) {
    grade = '‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°';
  } else if (percentageScore >= 60) {
    grade = '‡∏î‡∏µ';
  } else if (percentageScore >= 40) {
    grade = '‡∏û‡∏≠‡πÉ‡∏à';
  } else {
    grade = '‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á';
  }
  
  const opt = {
    margin: [12, 12, 12, 12],
    filename: `${teacherConfig.topic || 'score'}_${date.toISOString().split('T')[0]}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
  };

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PDF ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
  const pdfContent = `
    <div style="font-family: 'Arial', sans-serif; color: #333;">
      <!-- Header with Logo Style -->
      <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h1 style="margin: 5px 0; font-size: 24px;"> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h1>
        <p style="margin: 5px 0; font-size: 14px;">Smart Classroom Learning System</p>
      </div>

      <!-- Score Card - Main Focus -->
      <div style="background: #f8f9fa; border: 3px solid #667eea; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
        <p style="font-size: 16px; margin: 0 0 15px 0; color: #555;"><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</strong></p>
        <div style="display: flex; gap: 15px; justify-content: center;">
          <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border: 2px solid #27ae60;">
            <p style="font-size: 28px; color: #27ae60; font-weight: bold; margin: 0;">${score}/${teacherConfig.correctImages?.length || 0}</p>
            <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
          </div>
          <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border: 2px solid #f39c12;">
            <p style="font-size: 28px; color: #f39c12; font-weight: bold; margin: 0;">${grade}</p>
            <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">‡∏£‡∏∞‡∏î‡∏±‡∏ö</p>
          </div>
        </div>
      </div>

      <!-- Attempt Info -->
      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
        <p style="margin: 0; font-size: 14px;"><strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${playCount}</strong> - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô/‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
      </div>

      <!-- Course Info -->
      <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
        <p style="font-size: 14px; font-weight: bold; margin: 0 0 10px 0; color: #667eea;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.week || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.topic || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.unit || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.teacher || '-'}</td>
          </tr>
        </table>
      </div>

      <!-- Student Info -->
      <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
        <p style="font-size: 14px; font-weight: bold; margin: 0 0 10px 0; color: #667eea;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${teacherConfig.playerName || '-'}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${dateStr}</td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: bold; width: 30%; border-bottom: 1px solid #eee;">‡πÄ‡∏ß‡∏•‡∏≤:</td>
            <td style="padding: 8px; border-bottom: 1px solid #eee;">${timeStr}</td>
          </tr>
        </table>
      </div>

      <!-- Footer -->
      <div style="text-align: center; border-top: 2px solid #ddd; padding-top: 15px; margin-top: 20px; color: #999; font-size: 11px;">
        <p style="margin: 5px 0;">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£</p>
        <p style="margin: 5px 0;">Smart Classroom Learning Management System</p>
        <p style="margin: 5px 0; color: #bbb;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${date.toISOString()}</p>
      </div>

      <!-- Signature Section -->
      <div style="margin-top: 30px; padding: 0 20px;">
        <div style="margin-top: 30px; padding: 0 20px; text-align: right;">
        <p style="margin: 0 0 0 0; font-size: 10px; color: #333;">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ___________________</p>
        <p style="margin: 5px 0 0 0; font-size: 10px; color: #333;">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</p>
        <p style="margin: 2px 0 0 0; font-size: 10px; color: #333;">(_____________________)</p>
      </div>
    </div>
  `;

  // ‡πÉ‡∏ä‡πâ html2pdf
  const element2 = document.createElement('div');
  element2.innerHTML = pdfContent;
  html2pdf().set(opt).from(element2).save();
}


// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏°)
function initGame() {
  if (!teacherConfig.correctImages || !teacherConfig.wrongImages) {
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏π! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏π‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤");
    window.location.href = 'teacher.html';
    return;
  }

  createdImages = {};
  score = 0;
  document.getElementById('score').innerText = score;

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
  teacherConfig.correctImages.forEach((imgData, index) => {
    createDraggableImage(imgData, `correct-${index}`, true);
  });

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î
  teacherConfig.wrongImages.forEach((imgData, index) => {
    createDraggableImage(imgData, `wrong-${index}`, false);
  });
}




// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
initGame();
</script>
</body>
</html>


